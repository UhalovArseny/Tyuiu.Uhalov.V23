@rendermode InteractiveServer
@page "/tours"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]

<h3>Виртуальные туры</h3>

@if (!tours.Any())
{
    <p>Туров пока нет. Создайте первый тур ниже.</p>
}
else
{
    <div class="tours-list">
        @foreach (var tour in tours)
        {
            <div class="tour-card">
                <div class="tour-card-main">
                    <h4>@tour.Title</h4>
                    <p class="tour-desc">@tour.Description</p>

                    <div class="tour-meta">
                        @if (!string.IsNullOrWhiteSpace(tour.Date) || !string.IsNullOrWhiteSpace(tour.Time))
                        {
                            <div><b>Начало:</b> @tour.Date @tour.Time</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(tour.DurationMinutes))
                        {
                            <div><b>Длительность:</b> @tour.DurationMinutes мин</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(tour.ExhibitCount))
                        {
                            <div><b>Экспонатов в туре:</b> @tour.ExhibitCount</div>
                        }
                    </div>
                </div>

                <div class="tour-card-actions">
                    <button class="tour-button-danger"
                            @onclick="() => DeleteTour(tour)">
                        Удалить тур
                    </button>
                </div>
            </div>
        }
    </div>
}

<hr />

<h4>Создать новый тур</h4>

<div class="tour-form">
    <div class="tour-form-row">
        <input class="tour-input"
               placeholder="Название тура"
               @bind="form.Title" />
    </div>

    <div class="tour-form-row">
        <textarea class="tour-textarea"
                  placeholder="Краткое описание"
                  @bind="form.Description"></textarea>
    </div>

    <div class="tour-form-row-inline">
        <div class="tour-form-group">
            <label>Дата начала</label>
            <input type="text"
                   class="tour-input"
                   placeholder="Например: 12.12.2025"
                   @bind="form.Date" />
        </div>

        <div class="tour-form-group">
            <label>Время начала</label>
            <input type="text"
                   class="tour-input"
                   placeholder="Например: 14:30"
                   @bind="form.Time" />
        </div>

        <div class="tour-form-group">
            <label>Длительность (мин)</label>
            <input type="text"
                   class="tour-input"
                   placeholder="Например: 60"
                   @bind="form.DurationMinutes" />
        </div>
    </div>

    <div class="tour-form-row">
        <label>Количество экспонатов в туре</label>
        <input type="text"
               class="tour-input"
               placeholder="Например: 5"
               @bind="form.ExhibitCount" />
    </div>

    <button class="tour-button" @onclick="CreateTour">
        Создать тур
    </button>
</div>

@code {
    private List<TourViewModel> tours = new();

    private TourFormModel form = new();

    private void CreateTour()
    {
        if (string.IsNullOrWhiteSpace(form.Title))
            return;

        var tour = new TourViewModel
        {
            Title = form.Title!.Trim(),
            Description = form.Description?.Trim(),
            Date = form.Date,
            Time = form.Time,
            DurationMinutes = form.DurationMinutes,
            ExhibitCount = form.ExhibitCount
        };

        tours.Add(tour);

        form = new TourFormModel();
        StateHasChanged();
    }

    private void DeleteTour(TourViewModel tour)
    {
        tours.Remove(tour);
        StateHasChanged();
    }

    private class TourViewModel
    {
        public string Title { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string? Date { get; set; }
        public string? Time { get; set; }
        public string? DurationMinutes { get; set; }
        public string? ExhibitCount { get; set; }
    }

    private class TourFormModel
    {
        public string? Title { get; set; }
        public string? Description { get; set; }
        public string? Date { get; set; }
        public string? Time { get; set; }
        public string? DurationMinutes { get; set; }
        public string? ExhibitCount { get; set; }
    }
}
